var le=Object.defineProperty;var ue=(v,r,t)=>r in v?le(v,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):v[r]=t;var P=(v,r,t)=>(ue(v,typeof r!="symbol"?r+"":r,t),t);import{C as te,T as k,a as B,b as w,c as b,d as R,E as he,F as z,L as A}from"./Font.bcf37e5d.js";var F=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ie=`#version 300 es
in vec2 a_position;
in vec2 a_texcoord;

uniform mat3 u_transform;

out vec2 v_texcoord;

void main() {
  gl_Position = vec4((u_transform * vec3(a_position, 1)).xy, 0, 1);
  v_texcoord = a_texcoord;
}`,re=`#version 300 es
precision highp float;

in vec2 v_texcoord;

uniform sampler2D u_texture;

out vec4 outColor;

void main() {
    outColor = texture(u_texture, v_texcoord);
    outColor.rgb *= outColor.a;
}`;class de{constructor(r){this.gl=r,this.program=null,this.vertexShader=null,this.fragmentShader=null,this.positionAttributeLocation=null,this.transform=null,this.positionBuffer=null}init(){}_initShaderProgram(){}_initShaderAttributes(){}_loadAndCompileShader(r,t){}activateShader(){}updateTransform(r){}}const C=class{init(r){this.gl=r,C.vertexBuffer=this.gl.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,C.vertexBuffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(C.verticesOfSquare),r.STATIC_DRAW)}initTextureCoordBuffer(){this.textureCoordBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureCoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(C.verticesOfSquare),this.gl.STATIC_DRAW)}};let M=C;P(M,"verticesOfSquare",[0,0,0,1,1,0,1,0,0,1,1,1]),P(M,"vertexBuffer",null);var fe=`#version 300 es

in vec2 a_position;

uniform mat3 u_transform;

void main() {
  
 gl_Position = vec4((u_transform * vec3(a_position, 1)).xy, 0, 1);
}`,ce=`#version 300 es

precision highp float;

uniform vec4 u_color;

out vec4 outColor;

void main() {
  outColor = u_color;
}`;class q extends de{constructor(r){super(r)}init(){this._initShaderProgram(fe,ce),this._initShaderAttributes()}_initShaderProgram(r,t){if(this.vertexShader=this._loadAndCompileShader(this.gl.VERTEX_SHADER,r),this.fragmentShader=this._loadAndCompileShader(this.gl.FRAGMENT_SHADER,t),this.program=this.gl.createProgram(),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw new Error(`Unable to initialize the shader program: ${this.gl.getProgramInfoLog(this.program)}`)}_initShaderAttributes(){this.gl.useProgram(this.program),this.positionAttributeLocation=this.gl.getAttribLocation(this.program,"a_position"),this.colorLocation=this.gl.getUniformLocation(this.program,"u_color"),this.transformLocation=this.gl.getUniformLocation(this.program,"u_transform"),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,M.vertexBuffer),this.gl.vertexAttribPointer(this.positionAttributeLocation,3,this.gl.FLOAT,!1,0,0)}_loadAndCompileShader(r,t){var s,a=this.gl;if(s=a.createShader(r),a.shaderSource(s,t),a.compileShader(s),!a.getShaderParameter(s,a.COMPILE_STATUS))throw new Error(`A shader compiling error occurred: ${a.getShaderInfoLog(s)}`);return s}activateShader(r=te.WHITE){this.gl.useProgram(this.program),this.gl.enableVertexAttribArray(this.positionAttributeLocation),this.gl.uniform4f(this.colorLocation,r.glArray[0],r.glArray[1],r.glArray[2],r.glArray[3])}updateTransform(r){this.gl.useProgram(this.program),this.gl.uniformMatrix3fv(this.transformLocation,!1,r)}getShader(){return this.program}}P(q,"verticesOfSquare",[0,0,0,1,1,0,1,0,0,1,1,1]);const W=class extends q{constructor(r){super(r)}init(){this._initShaderProgram(ie,re),this._initShaderAttributes()}_initShaderAttributes(){this.gl.useProgram(this.program),this.positionAttributeLocation=this.gl.getAttribLocation(this.program,"a_position"),this.colorLocation=this.gl.getUniformLocation(this.program,"u_color"),this.transformLocation=this.gl.getUniformLocation(this.program,"u_transform"),this.texcoordAttributeLocation=this.gl.getAttribLocation(this.program,"a_texcoord"),this.textureLocation=this.gl.getUniformLocation(this.program,"u_texture"),this.vao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.vao);var r=2,t=this.gl.FLOAT,s=!1,a=0,f=0;this.positionBuffer=this.gl.createBuffer(),this.gl.enableVertexAttribArray(this.positionAttributeLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(W.verticesOfSquare),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionAttributeLocation,r,t,s,a,f),this.texcoordBuffer=this.gl.createBuffer(),this.gl.enableVertexAttribArray(this.texcoordAttributeLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(W.verticesOfSquare),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.texcoordAttributeLocation,r,t,s,a,f)}activateShader(r,t=k.BLEND_TYPE.NORMAL){this.gl.enable(this.gl.BLEND),t===k.BLEND_TYPE.NORMAL?this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):t===k.BLEND_TYPE.ADDITIVE?this.gl.blendFunc(this.gl.ONE,this.gl.ONE):t===k.BLEND_TYPE.MULTIPLY&&this.gl.blendFunc(this.gl.DST_COLOR,this.gl.ZERO),this.gl.useProgram(this.program),this.gl.bindVertexArray(this.vao),this.gl.uniform1i(this.textureLocation,0),this.gl.activeTexture(this.gl.TEXTURE0+0),this.gl.bindTexture(this.gl.TEXTURE_2D,r);var s=0,a=6;this.gl.drawArrays(this.gl.TRIANGLES,s,a)}};let O=W;P(O,"verticesOfSquare",[0,0,0,1,1,0,1,0,0,1,1,1]);class S extends B{constructor(r,t){super(),this.texture=t,this.transform.textureMode=!0,this.transform.width=t.width,this.transform.height=t.height,this.shader=new O(r),this.shader.transform=this.transform,this.blendType=k.BLEND_TYPE.NORMAL,this.shader.init()}_render(r){this.shader.activateShader(this.texture.texture,this.blendType)}updateTransform(){super.updateTransform(),this.shader.updateTransform(this.transform.worldTransform.array)}}const Z=class{constructor(){let r=Z.default;this.duration=r.duration,this.loop=r.loop,this.autoPlay=r.autoPlay,this.onComplete=r.onComplete,this.onLoop=r.onLoop,this._parent=null}};let V=Z;P(V,"default",{duration:1,loop:!1,autoPlay:!0,onComplete:null,onLoop:null});class U extends S{constructor(r,t,s=V.default){super(r,t[0]),this.textures=t,this.config=s,this.progress=0,this._curIndex=0,this.isPlaying=this.config.autoPlay,this.isCompleted=!1,this._curTimeCount=0,this.visible=this.config.autoPlay,w.SharedTicker.add(this._update,this)}play(){this.isPlaying=!0,this.visible=!0}stop(){this.isPlaying=!1,this.visible=!0}reset(){this.currentIndex=0,this._curTimeCount=0}_update(){var r,t,s,a;!this.isPlaying||this.isCompleted||(this._curTimeCount+=w.SharedTicker.deltaTime,this._curTimeCount>this.config.duration&&(this.config.loop?(this._curTimeCount=0,(t=(r=this.config).onLoop)==null||t.call(r)):this.isCompleted||(this.isCompleted=!0,(a=(s=this.config).onComplete)==null||a.call(s))),!this.isCompleted&&(this.progress=Math.min(this._curTimeCount/this.config.duration,1),this.currentIndex=Math.floor(this.progress*this.textures.length)))}_render(){this.isPlaying&&!this.isCompleted&&this.visible&&this.shader.activateShader(this.texture.texture,this.blendType)}get currentIndex(){return this._curIndex||0}set currentIndex(r){this._curIndex=r,this.currentIndex>=this.textures.length&&(this.currentIndex=0),this.texture=this.textures[this._curIndex]}}var _e=`#version 300 es
precision mediump float;

uniform float u_TimeDelta;
uniform sampler2D u_RgNoise;
uniform sampler2D u_ForceField;
uniform vec2 u_Gravity;
uniform vec2 u_Origin;
uniform float u_MinTheta;
uniform float u_MaxTheta;
uniform float u_MinSpeed;
uniform float u_MaxSpeed;

in vec2 i_Position;
in float i_Age;
in float i_Life;
in vec2 i_Velocity;

out vec2 v_Position;
out float v_Age;
out float v_Life;
out vec2 v_Velocity;

void main() {
  vec2 force = 4.0 * (2.0 * texture(u_ForceField, i_Position).rg - vec2(1.0));
  if (i_Age >= i_Life) {
    ivec2 noise_coord = ivec2(gl_VertexID % 512, gl_VertexID / 512);
    vec2 rand = texelFetch(u_RgNoise, noise_coord, 0).rg;
    float theta = u_MinTheta + rand.r*(u_MaxTheta - u_MinTheta);
    float x = cos(theta);
    float y = sin(theta);
    v_Position = u_Origin;
    v_Age = 0.0;
    v_Life = i_Life;
    v_Velocity =
      vec2(x, y) * (u_MinSpeed + rand.g * (u_MaxSpeed - u_MinSpeed));
  } else {
    v_Position = i_Position + i_Velocity * u_TimeDelta;
    v_Age = i_Age + u_TimeDelta;
    v_Life = i_Life;
    v_Velocity = i_Velocity + u_Gravity * u_TimeDelta + force * u_TimeDelta;
  }

}`,pe=`#version 300 es
precision mediump float;
in float v_Age;
void main() { discard; }`,me=`#version 300 es
precision mediump float;

in vec2 i_Position;
in float i_Age;
in float i_Life;
in vec2 i_Velocity;

in vec2 i_Coord;
in vec2 i_TexCoord;

uniform float u_StartScale;
uniform float u_EndScale;

out float v_Age;
out float v_Life;
out vec2 v_TexCoord;

void main() {
  vec2 vert_coord = i_Position +
					(u_StartScale*(1.0-i_Age / i_Life) + u_EndScale) * 0.1 * i_Coord +
					i_Velocity * 0.0;
  v_Age = i_Age;
  v_Life = i_Life;

  v_TexCoord = i_TexCoord;

  gl_Position = vec4(vert_coord, 0, 1);
}`,ge=`#version 300 es
precision mediump float;

uniform sampler2D u_Sprite;

in float v_Age;
in float v_Life;
in vec2 v_TexCoord;

out vec4 o_FragColor;

void main() {
  float t =  v_Age/v_Life;
  vec4 color = vec4(vec3(1.0, 0.8, 0.3), 1.0-(v_Age/v_Life));
  o_FragColor = color * texture(u_Sprite, v_TexCoord);
}`;class ve extends q{constructor(r){super(r),this.texture=null}init(r){this._initShaderProgram(r)}_createShaderProgram(r,t,s){this.vertexShader=this._loadAndCompileShader(this.gl.VERTEX_SHADER,r),this.fragmentShader=this._loadAndCompileShader(this.gl.FRAGMENT_SHADER,t);let a=this.gl.createProgram();if(this.gl.attachShader(a,this.vertexShader),this.gl.attachShader(a,this.fragmentShader),s!==null&&this.gl.transformFeedbackVaryings(a,s,this.gl.INTERLEAVED_ATTRIBS),this.gl.linkProgram(a),this.gl.linkProgram(a),!this.gl.getProgramParameter(a,this.gl.LINK_STATUS))throw new Error(`Unable to initialize the shader program: ${this.gl.getProgramInfoLog(a)}`);return a}_setupParticleBufferVAO(r,t){this.gl.bindVertexArray(t);for(let s=0;s<r.length;s++){let a=r[s];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.bufferObject);let f=0;for(let d in a.attribs)if(a.attribs.hasOwnProperty(d)){let c=a.attribs[d];this.gl.enableVertexAttribArray(c.location),this.gl.vertexAttribPointer(c.location,c.numComponents,c.type,!1,a.stride,f);let _=4;f+=c.numComponents*_,c.hasOwnProperty("divisor")&&this.gl.vertexAttribDivisor(c.location,c.divisor)}}this.gl.bindVertexArray(null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}_initialParticleData(r,t,s){for(var a=[],f=0;f<r;++f){a.push(0),a.push(0);var d=t+Math.random()*(s-t);a.push(d+1),a.push(d),a.push(0),a.push(0)}return a}_initShaderProgram(r){this.updateProgram=this._createShaderProgram(_e,pe,["v_Position","v_Age","v_Life","v_Velocity"]),this.renderProgram=this._createShaderProgram(me,ge,null);var t={i_Position:{location:this.gl.getAttribLocation(this.updateProgram,"i_Position"),numComponents:2,type:this.gl.FLOAT},i_Age:{location:this.gl.getAttribLocation(this.updateProgram,"i_Age"),numComponents:1,type:this.gl.FLOAT},i_Life:{location:this.gl.getAttribLocation(this.updateProgram,"i_Life"),numComponents:1,type:this.gl.FLOAT},i_Velocity:{location:this.gl.getAttribLocation(this.updateProgram,"i_Velocity"),numComponents:2,type:this.gl.FLOAT}},s={i_Position:{location:this.gl.getAttribLocation(this.renderProgram,"i_Position"),numComponents:2,type:this.gl.FLOAT,divisor:1},i_Age:{location:this.gl.getAttribLocation(this.renderProgram,"i_Age"),numComponents:1,type:this.gl.FLOAT,divisor:1},i_Life:{location:this.gl.getAttribLocation(this.renderProgram,"i_Life"),numComponents:1,type:this.gl.FLOAT,divisor:1}};this.vaos=[this.gl.createVertexArray(),this.gl.createVertexArray(),this.gl.createVertexArray(),this.gl.createVertexArray()],this.buffers=[this.gl.createBuffer(),this.gl.createBuffer()];var a=new Float32Array([1,1,1,1,-1,1,0,1,-1,-1,0,0,1,1,1,1,-1,-1,0,0,1,-1,1,0]),f={i_Coord:{location:this.gl.getAttribLocation(this.renderProgram,"i_Coord"),numComponents:2,type:this.gl.FLOAT},i_TexCoord:{location:this.gl.getAttribLocation(this.renderProgram,"i_TexCoord"),numComponents:2,type:this.gl.FLOAT}},d=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,d),this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.STATIC_DRAW),this.vaoDesc=[{vao:this.vaos[0],buffers:[{bufferObject:this.buffers[0],stride:4*6,attribs:t}]},{vao:this.vaos[1],buffers:[{bufferObject:this.buffers[1],stride:4*6,attribs:t}]},{vao:this.vaos[2],buffers:[{bufferObject:this.buffers[0],stride:4*6,attribs:s},{bufferObject:d,stride:4*4,attribs:f}]},{vao:this.vaos[3],buffers:[{bufferObject:this.buffers[1],stride:4*6,attribs:s},{bufferObject:d,stride:4*4,attribs:f}]}],this.initialData=new Float32Array(this._initialParticleData(r.numParticles,r.minLifeRange,r.maxLifeRange)),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffers[0]),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.initialData,this.gl.STREAM_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffers[1]),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.initialData,this.gl.STREAM_DRAW),this.numParticles=this.initialData.length/6;for(var c=0;c<this.vaoDesc.length;c++)this._setupParticleBufferVAO(this.vaoDesc[c].buffers,this.vaoDesc[c].vao);this.rangeNoiseTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.rangeNoiseTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RG8,512,512,0,this.gl.RG,this.gl.UNSIGNED_BYTE,ye(512,512)),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.MIRRORED_REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.MIRRORED_REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE),this.particleTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.particleTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA8,32,32,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.texture.texture.image),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR)}renderParticle(r,t){var s=t.bornParticles;if(t.pause){if(s<0)return;let f=Math.min(t.bornParticles,Math.floor(t.bornParticles-t.birthRate*r*1e3));t.bornParticles=f}else if(t.bornParticles<this.numParticles){let f=Math.min(this.numParticles,Math.floor(t.bornParticles+t.birthRate*r*1e3));t.bornParticles=f}if(!(s<=0)){this.gl.useProgram(this.updateProgram),this.gl.uniform1f(this.gl.getUniformLocation(this.updateProgram,"u_TimeDelta"),r),this.gl.uniform1f(this.gl.getUniformLocation(this.updateProgram,"u_TotalTime"),t.totalTime),this.gl.uniform2f(this.gl.getUniformLocation(this.updateProgram,"u_Gravity"),t.gravity[0],t.gravity[1]),this.gl.uniform2f(this.gl.getUniformLocation(this.updateProgram,"u_Origin"),t.x,t.y),this.gl.uniform1f(this.gl.getUniformLocation(this.updateProgram,"u_MinTheta"),t.minTheta),this.gl.uniform1f(this.gl.getUniformLocation(this.updateProgram,"u_MaxTheta"),t.maxTheta),this.gl.uniform1f(this.gl.getUniformLocation(this.updateProgram,"u_MinSpeed"),t.minSpeed),this.gl.uniform1f(this.gl.getUniformLocation(this.updateProgram,"u_MaxSpeed"),t.maxSpeed),t.totalTime+=r,this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.rangeNoiseTexture),this.gl.uniform1i(this.gl.getUniformLocation(this.updateProgram,"u_RgNoise"),0),this.gl.bindVertexArray(this.vaos[t.read]),this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,0,this.buffers[t.write]),this.gl.enable(this.gl.RASTERIZER_DISCARD),this.gl.beginTransformFeedback(this.gl.POINTS),this.gl.drawArrays(this.gl.POINTS,0,s),this.gl.endTransformFeedback(),this.gl.disable(this.gl.RASTERIZER_DISCARD),this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,0,null),this.gl.bindVertexArray(this.vaos[t.read+2]),this.gl.useProgram(this.renderProgram),this.gl.uniform1f(this.gl.getUniformLocation(this.renderProgram,"u_StartScale"),t.startScale),this.gl.uniform1f(this.gl.getUniformLocation(this.renderProgram,"u_EndScale"),t.endScale),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.particleTexture),this.gl.uniform1i(this.gl.getUniformLocation(this.renderProgram,"u_Sprite"),0),this.gl.drawArraysInstanced(this.gl.TRIANGLES,0,6,s);var a=t.read;t.read=t.write,t.write=a}}}function ye(v,r){let t=[];for(let s=0;s<v*r;++s)t.push(Math.random()*255),t.push(Math.random()*255);return new Uint8Array(t)}const Q=class{constructor(){let r=Q.default;this.x=r.x,this.y=r.y,this.numParticles=r.numParticles,this.birthRate=r.birthRate,this.minLifeRange=r.minLifeRange,this.maxLifeRange=r.maxLifeRange,this.minTheta=r.minTheta,this.maxTheta=r.maxTheta,this.minSpeed=r.minSpeed,this.maxSpeed=r.maxSpeed,this.startScale=r.startScale,this.endScale=r.endScale,this.gravity=r.gravity}};let N=Q;P(N,"default",{x:0,y:0,numParticles:11,birthRate:1,minLifeRange:.5,maxLifeRange:.5,minTheta:0,maxTheta:0,minSpeed:0,maxSpeed:0,startScale:1,endScale:0,gravity:[0,1]});class Ae extends B{constructor(r,t=N.default){super(),this.texture=r,this.config=t,this.canPlay=!1}_initBeforeFirstRender(){if(this.gl!==null){if(this.maxLifeRange<this.minLifeRange)throw"Invalid min-max age range.";if(this.maxTheta<this.minTheta||this.minTheta<-Math.PI||this.maxTheta>Math.PI)throw"Invalid theta range.";if(this.minSpeed>this.maxSpeed)throw"Invalid min-max speed range.";this.convertPositionToClipSpace(),this.state=this.config,this.state.pause=!1,this.state.bornParticles=0,this.state.read=0,this.state.write=1,this.state.oldTimestamp=0,this.state.totalTime=0,this.shader=new ve(this.gl),this.shader.texture=this.texture,this.shader.init(this.state)}else document.write("WebGL2 is not supported by your browser")}play(){this.canPlay=!0,this.state&&(this.state.pause=!1)}_render(){this.canPlay&&this.shader.renderParticle(w.SharedTicker.deltaTime,this.state)}convertPositionToClipSpace(){this.particleX=this.x/this.gl.canvas.width*2-1,this.particleY=-(this.y/this.gl.canvas.height*2-1),this.state&&(this.state.x=this.particleX,this.state.y=this.particleY)}pause(){this.state.pause=!0}stop(){this.canPlay=!1}get x(){return this._x}set x(r){this._x!==r&&(this._x=r,this.convertPositionToClipSpace())}get y(){return this._y}set y(r){this._y!==r&&(this._y=r,this.convertPositionToClipSpace())}}var H={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(v){(function(){var r=function(){this.init()};r.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator=typeof window!="undefined"&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var i=this||t;if(e=parseFloat(e),i.ctx||x(),typeof e!="undefined"&&e>=0&&e<=1){if(i._volume=e,i._muted)return i;i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var n=0;n<i._howls.length;n++)if(!i._howls[n]._webAudio)for(var o=i._howls[n]._getSoundIds(),u=0;u<o.length;u++){var h=i._howls[n]._soundById(o[u]);h&&h._node&&(h._node.volume=h._volume*e)}return i}return i._volume},mute:function(e){var i=this||t;i.ctx||x(),i._muted=e,i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e?0:i._volume,t.ctx.currentTime);for(var n=0;n<i._howls.length;n++)if(!i._howls[n]._webAudio)for(var o=i._howls[n]._getSoundIds(),u=0;u<o.length;u++){var h=i._howls[n]._soundById(o[u]);h&&h._node&&(h._node.muted=e?!0:h._muted)}return i},stop:function(){for(var e=this||t,i=0;i<e._howls.length;i++)e._howls[i].stop();return e},unload:function(){for(var e=this||t,i=e._howls.length-1;i>=0;i--)e._howls[i].unload();return e.usingWebAudio&&e.ctx&&typeof e.ctx.close!="undefined"&&(e.ctx.close(),e.ctx=null,x()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if(typeof Audio!="undefined")try{var i=new Audio;typeof i.oncanplaythrough=="undefined"&&(e._canPlayEvent="canplay")}catch{e.noAudio=!0}else e.noAudio=!0;try{var i=new Audio;i.muted&&(e.noAudio=!0)}catch{}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,i=null;try{i=typeof Audio!="undefined"?new Audio:null}catch{return e}if(!i||typeof i.canPlayType!="function")return e;var n=i.canPlayType("audio/mpeg;").replace(/^no$/,""),o=e._navigator?e._navigator.userAgent:"",u=o.match(/OPR\/([0-6].)/g),h=u&&parseInt(u[0].split("/")[1],10)<33,l=o.indexOf("Safari")!==-1&&o.indexOf("Chrome")===-1,m=o.match(/Version\/(.*?) /),g=l&&m&&parseInt(m[1],10)<15;return e._codecs={mp3:!!(!h&&(n||i.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!n,opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(i.canPlayType('audio/wav; codecs="1"')||i.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!i.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!i.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(i.canPlayType("audio/x-m4b;")||i.canPlayType("audio/m4b;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(i.canPlayType("audio/x-mp4;")||i.canPlayType("audio/mp4;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!g&&i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!g&&i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!i.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(i.canPlayType("audio/x-flac;")||i.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!(e._audioUnlocked||!e.ctx)){e._audioUnlocked=!1,e.autoUnlock=!1,!e._mobileUnloaded&&e.ctx.sampleRate!==44100&&(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var i=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,e._releaseHtml5Audio(o)}catch{e.noAudio=!0;break}for(var u=0;u<e._howls.length;u++)if(!e._howls[u]._webAudio)for(var h=e._howls[u]._getSoundIds(),l=0;l<h.length;l++){var m=e._howls[u]._soundById(h[l]);m&&m._node&&!m._node._unlocked&&(m._node._unlocked=!0,m._node.load())}e._autoResume();var g=e.ctx.createBufferSource();g.buffer=e._scratchBuffer,g.connect(e.ctx.destination),typeof g.start=="undefined"?g.noteOn(0):g.start(0),typeof e.ctx.resume=="function"&&e.ctx.resume(),g.onended=function(){g.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",i,!0),document.removeEventListener("touchend",i,!0),document.removeEventListener("click",i,!0),document.removeEventListener("keydown",i,!0);for(var T=0;T<e._howls.length;T++)e._howls[T]._emit("unlock")}};return document.addEventListener("touchstart",i,!0),document.addEventListener("touchend",i,!0),document.addEventListener("click",i,!0),document.addEventListener("keydown",i,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var i=new Audio().play();return i&&typeof Promise!="undefined"&&(i instanceof Promise||typeof i.then=="function")&&i.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var i=this||t;return e._unlocked&&i._html5AudioPool.push(e),i},_autoSuspend:function(){var e=this;if(!(!e.autoSuspend||!e.ctx||typeof e.ctx.suspend=="undefined"||!t.usingWebAudio)){for(var i=0;i<e._howls.length;i++)if(e._howls[i]._webAudio){for(var n=0;n<e._howls[i]._sounds.length;n++)if(!e._howls[i]._sounds[n]._paused)return e}return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(!!e.autoSuspend){e._suspendTimer=null,e.state="suspending";var o=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(o,o)}},3e4),e}},_autoResume:function(){var e=this;if(!(!e.ctx||typeof e.ctx.resume=="undefined"||!t.usingWebAudio))return e.state==="running"&&e.ctx.state!=="interrupted"&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):e.state==="suspended"||e.state==="running"&&e.ctx.state==="interrupted"?(e.ctx.resume().then(function(){e.state="running";for(var i=0;i<e._howls.length;i++)e._howls[i]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):e.state==="suspending"&&(e._resumeAfterSuspend=!0),e}};var t=new r,s=function(e){var i=this;if(!e.src||e.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}i.init(e)};s.prototype={init:function(e){var i=this;return t.ctx||x(),i._autoplay=e.autoplay||!1,i._format=typeof e.format!="string"?e.format:[e.format],i._html5=e.html5||!1,i._muted=e.mute||!1,i._loop=e.loop||!1,i._pool=e.pool||5,i._preload=typeof e.preload=="boolean"||e.preload==="metadata"?e.preload:!0,i._rate=e.rate||1,i._sprite=e.sprite||{},i._src=typeof e.src!="string"?e.src:[e.src],i._volume=e.volume!==void 0?e.volume:1,i._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:e.xhr&&e.xhr.withCredentials?e.xhr.withCredentials:!1},i._duration=0,i._state="unloaded",i._sounds=[],i._endTimers={},i._queue=[],i._playLock=!1,i._onend=e.onend?[{fn:e.onend}]:[],i._onfade=e.onfade?[{fn:e.onfade}]:[],i._onload=e.onload?[{fn:e.onload}]:[],i._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],i._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],i._onpause=e.onpause?[{fn:e.onpause}]:[],i._onplay=e.onplay?[{fn:e.onplay}]:[],i._onstop=e.onstop?[{fn:e.onstop}]:[],i._onmute=e.onmute?[{fn:e.onmute}]:[],i._onvolume=e.onvolume?[{fn:e.onvolume}]:[],i._onrate=e.onrate?[{fn:e.onrate}]:[],i._onseek=e.onseek?[{fn:e.onseek}]:[],i._onunlock=e.onunlock?[{fn:e.onunlock}]:[],i._onresume=[],i._webAudio=t.usingWebAudio&&!i._html5,typeof t.ctx!="undefined"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(i),i._autoplay&&i._queue.push({event:"play",action:function(){i.play()}}),i._preload&&i._preload!=="none"&&i.load(),i},load:function(){var e=this,i=null;if(t.noAudio){e._emit("loaderror",null,"No audio support.");return}typeof e._src=="string"&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var o,u;if(e._format&&e._format[n])o=e._format[n];else{if(u=e._src[n],typeof u!="string"){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}o=/^data:audio\/([^;,]+);/i.exec(u),o||(o=/\.([^.]+)$/.exec(u.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),o&&t.codecs(o)){i=e._src[n];break}}if(!i){e._emit("loaderror",null,"No codec support for selected audio sources.");return}return e._src=i,e._state="loading",window.location.protocol==="https:"&&i.slice(0,5)==="http:"&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&d(e),e},play:function(e,i){var n=this,o=null;if(typeof e=="number")o=e,e=null;else{if(typeof e=="string"&&n._state==="loaded"&&!n._sprite[e])return null;if(typeof e=="undefined"&&(e="__default",!n._playLock)){for(var u=0,h=0;h<n._sounds.length;h++)n._sounds[h]._paused&&!n._sounds[h]._ended&&(u++,o=n._sounds[h]._id);u===1?e=null:o=null}}var l=o?n._soundById(o):n._inactiveSound();if(!l)return null;if(o&&!e&&(e=l._sprite||"__default"),n._state!=="loaded"){l._sprite=e,l._ended=!1;var m=l._id;return n._queue.push({event:"play",action:function(){n.play(m)}}),m}if(o&&!l._paused)return i||n._loadQueue("play"),l._id;n._webAudio&&t._autoResume();var g=Math.max(0,l._seek>0?l._seek:n._sprite[e][0]/1e3),T=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-g),E=T*1e3/Math.abs(l._rate),I=n._sprite[e][0]/1e3,G=(n._sprite[e][0]+n._sprite[e][1])/1e3;l._sprite=e,l._ended=!1;var $=function(){l._paused=!1,l._seek=g,l._start=I,l._stop=G,l._loop=!!(l._loop||n._sprite[e][2])};if(g>=G){n._ended(l);return}var y=l._node;if(n._webAudio){var j=function(){n._playLock=!1,$(),n._refreshBuffer(l);var D=l._muted||n._muted?0:l._volume;y.gain.setValueAtTime(D,t.ctx.currentTime),l._playStart=t.ctx.currentTime,typeof y.bufferSource.start=="undefined"?l._loop?y.bufferSource.noteGrainOn(0,g,86400):y.bufferSource.noteGrainOn(0,g,T):l._loop?y.bufferSource.start(0,g,86400):y.bufferSource.start(0,g,T),E!==1/0&&(n._endTimers[l._id]=setTimeout(n._ended.bind(n,l),E)),i||setTimeout(function(){n._emit("play",l._id),n._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?j():(n._playLock=!0,n.once("resume",j),n._clearTimer(l._id))}else{var K=function(){y.currentTime=g,y.muted=l._muted||n._muted||t._muted||y.muted,y.volume=l._volume*t.volume(),y.playbackRate=l._rate;try{var D=y.play();if(D&&typeof Promise!="undefined"&&(D instanceof Promise||typeof D.then=="function")?(n._playLock=!0,$(),D.then(function(){n._playLock=!1,y._unlocked=!0,i?n._loadQueue():n._emit("play",l._id)}).catch(function(){n._playLock=!1,n._emit("playerror",l._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),l._ended=!0,l._paused=!0})):i||(n._playLock=!1,$(),n._emit("play",l._id)),y.playbackRate=l._rate,y.paused){n._emit("playerror",l._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}e!=="__default"||l._loop?n._endTimers[l._id]=setTimeout(n._ended.bind(n,l),E):(n._endTimers[l._id]=function(){n._ended(l),y.removeEventListener("ended",n._endTimers[l._id],!1)},y.addEventListener("ended",n._endTimers[l._id],!1))}catch(oe){n._emit("playerror",l._id,oe)}};y.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(y.src=n._src,y.load());var ae=window&&window.ejecta||!y.readyState&&t._navigator.isCocoonJS;if(y.readyState>=3||ae)K();else{n._playLock=!0,n._state="loading";var J=function(){n._state="loaded",K(),y.removeEventListener(t._canPlayEvent,J,!1)};y.addEventListener(t._canPlayEvent,J,!1),n._clearTimer(l._id)}}return l._id},pause:function(e){var i=this;if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"pause",action:function(){i.pause(e)}}),i;for(var n=i._getSoundIds(e),o=0;o<n.length;o++){i._clearTimer(n[o]);var u=i._soundById(n[o]);if(u&&!u._paused&&(u._seek=i.seek(n[o]),u._rateSeek=0,u._paused=!0,i._stopFade(n[o]),u._node))if(i._webAudio){if(!u._node.bufferSource)continue;typeof u._node.bufferSource.stop=="undefined"?u._node.bufferSource.noteOff(0):u._node.bufferSource.stop(0),i._cleanBuffer(u._node)}else(!isNaN(u._node.duration)||u._node.duration===1/0)&&u._node.pause();arguments[1]||i._emit("pause",u?u._id:null)}return i},stop:function(e,i){var n=this;if(n._state!=="loaded"||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var o=n._getSoundIds(e),u=0;u<o.length;u++){n._clearTimer(o[u]);var h=n._soundById(o[u]);h&&(h._seek=h._start||0,h._rateSeek=0,h._paused=!0,h._ended=!0,n._stopFade(o[u]),h._node&&(n._webAudio?h._node.bufferSource&&(typeof h._node.bufferSource.stop=="undefined"?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),n._cleanBuffer(h._node)):(!isNaN(h._node.duration)||h._node.duration===1/0)&&(h._node.currentTime=h._start||0,h._node.pause(),h._node.duration===1/0&&n._clearSound(h._node))),i||n._emit("stop",h._id))}return n},mute:function(e,i){var n=this;if(n._state!=="loaded"||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,i)}}),n;if(typeof i=="undefined")if(typeof e=="boolean")n._muted=e;else return n._muted;for(var o=n._getSoundIds(i),u=0;u<o.length;u++){var h=n._soundById(o[u]);h&&(h._muted=e,h._interval&&n._stopFade(h._id),n._webAudio&&h._node?h._node.gain.setValueAtTime(e?0:h._volume,t.ctx.currentTime):h._node&&(h._node.muted=t._muted?!0:e),n._emit("mute",h._id))}return n},volume:function(){var e=this,i=arguments,n,o;if(i.length===0)return e._volume;if(i.length===1||i.length===2&&typeof i[1]=="undefined"){var u=e._getSoundIds(),h=u.indexOf(i[0]);h>=0?o=parseInt(i[0],10):n=parseFloat(i[0])}else i.length>=2&&(n=parseFloat(i[0]),o=parseInt(i[1],10));var l;if(typeof n!="undefined"&&n>=0&&n<=1){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"volume",action:function(){e.volume.apply(e,i)}}),e;typeof o=="undefined"&&(e._volume=n),o=e._getSoundIds(o);for(var m=0;m<o.length;m++)l=e._soundById(o[m]),l&&(l._volume=n,i[2]||e._stopFade(o[m]),e._webAudio&&l._node&&!l._muted?l._node.gain.setValueAtTime(n,t.ctx.currentTime):l._node&&!l._muted&&(l._node.volume=n*t.volume()),e._emit("volume",l._id))}else return l=o?e._soundById(o):e._sounds[0],l?l._volume:0;return e},fade:function(e,i,n,o){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"fade",action:function(){u.fade(e,i,n,o)}}),u;e=Math.min(Math.max(0,parseFloat(e)),1),i=Math.min(Math.max(0,parseFloat(i)),1),n=parseFloat(n),u.volume(e,o);for(var h=u._getSoundIds(o),l=0;l<h.length;l++){var m=u._soundById(h[l]);if(m){if(o||u._stopFade(h[l]),u._webAudio&&!m._muted){var g=t.ctx.currentTime,T=g+n/1e3;m._volume=e,m._node.gain.setValueAtTime(e,g),m._node.gain.linearRampToValueAtTime(i,T)}u._startFadeInterval(m,e,i,n,h[l],typeof o=="undefined")}}return u},_startFadeInterval:function(e,i,n,o,u,h){var l=this,m=i,g=n-i,T=Math.abs(g/.01),E=Math.max(4,T>0?o/T:o),I=Date.now();e._fadeTo=n,e._interval=setInterval(function(){var G=(Date.now()-I)/o;I=Date.now(),m+=g*G,m=Math.round(m*100)/100,g<0?m=Math.max(n,m):m=Math.min(n,m),l._webAudio?e._volume=m:l.volume(m,e._id,!0),h&&(l._volume=m),(n<i&&m<=n||n>i&&m>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,l.volume(n,e._id),l._emit("fade",e._id))},E)},_stopFade:function(e){var i=this,n=i._soundById(e);return n&&n._interval&&(i._webAudio&&n._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(n._interval),n._interval=null,i.volume(n._fadeTo,e),n._fadeTo=null,i._emit("fade",e)),i},loop:function(){var e=this,i=arguments,n,o,u;if(i.length===0)return e._loop;if(i.length===1)if(typeof i[0]=="boolean")n=i[0],e._loop=n;else return u=e._soundById(parseInt(i[0],10)),u?u._loop:!1;else i.length===2&&(n=i[0],o=parseInt(i[1],10));for(var h=e._getSoundIds(o),l=0;l<h.length;l++)u=e._soundById(h[l]),u&&(u._loop=n,e._webAudio&&u._node&&u._node.bufferSource&&(u._node.bufferSource.loop=n,n&&(u._node.bufferSource.loopStart=u._start||0,u._node.bufferSource.loopEnd=u._stop,e.playing(h[l])&&(e.pause(h[l],!0),e.play(h[l],!0)))));return e},rate:function(){var e=this,i=arguments,n,o;if(i.length===0)o=e._sounds[0]._id;else if(i.length===1){var u=e._getSoundIds(),h=u.indexOf(i[0]);h>=0?o=parseInt(i[0],10):n=parseFloat(i[0])}else i.length===2&&(n=parseFloat(i[0]),o=parseInt(i[1],10));var l;if(typeof n=="number"){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"rate",action:function(){e.rate.apply(e,i)}}),e;typeof o=="undefined"&&(e._rate=n),o=e._getSoundIds(o);for(var m=0;m<o.length;m++)if(l=e._soundById(o[m]),l){e.playing(o[m])&&(l._rateSeek=e.seek(o[m]),l._playStart=e._webAudio?t.ctx.currentTime:l._playStart),l._rate=n,e._webAudio&&l._node&&l._node.bufferSource?l._node.bufferSource.playbackRate.setValueAtTime(n,t.ctx.currentTime):l._node&&(l._node.playbackRate=n);var g=e.seek(o[m]),T=(e._sprite[l._sprite][0]+e._sprite[l._sprite][1])/1e3-g,E=T*1e3/Math.abs(l._rate);(e._endTimers[o[m]]||!l._paused)&&(e._clearTimer(o[m]),e._endTimers[o[m]]=setTimeout(e._ended.bind(e,l),E)),e._emit("rate",l._id)}}else return l=e._soundById(o),l?l._rate:e._rate;return e},seek:function(){var e=this,i=arguments,n,o;if(i.length===0)e._sounds.length&&(o=e._sounds[0]._id);else if(i.length===1){var u=e._getSoundIds(),h=u.indexOf(i[0]);h>=0?o=parseInt(i[0],10):e._sounds.length&&(o=e._sounds[0]._id,n=parseFloat(i[0]))}else i.length===2&&(n=parseFloat(i[0]),o=parseInt(i[1],10));if(typeof o=="undefined")return 0;if(typeof n=="number"&&(e._state!=="loaded"||e._playLock))return e._queue.push({event:"seek",action:function(){e.seek.apply(e,i)}}),e;var l=e._soundById(o);if(l)if(typeof n=="number"&&n>=0){var m=e.playing(o);m&&e.pause(o,!0),l._seek=n,l._ended=!1,e._clearTimer(o),!e._webAudio&&l._node&&!isNaN(l._node.duration)&&(l._node.currentTime=n);var g=function(){m&&e.play(o,!0),e._emit("seek",o)};if(m&&!e._webAudio){var T=function(){e._playLock?setTimeout(T,0):g()};setTimeout(T,0)}else g()}else if(e._webAudio){var E=e.playing(o)?t.ctx.currentTime-l._playStart:0,I=l._rateSeek?l._rateSeek-l._seek:0;return l._seek+(I+E*Math.abs(l._rate))}else return l._node.currentTime;return e},playing:function(e){var i=this;if(typeof e=="number"){var n=i._soundById(e);return n?!n._paused:!1}for(var o=0;o<i._sounds.length;o++)if(!i._sounds[o]._paused)return!0;return!1},duration:function(e){var i=this,n=i._duration,o=i._soundById(e);return o&&(n=i._sprite[o._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,i=e._sounds,n=0;n<i.length;n++)i[n]._paused||e.stop(i[n]._id),e._webAudio||(e._clearSound(i[n]._node),i[n]._node.removeEventListener("error",i[n]._errorFn,!1),i[n]._node.removeEventListener(t._canPlayEvent,i[n]._loadFn,!1),i[n]._node.removeEventListener("ended",i[n]._endFn,!1),t._releaseHtml5Audio(i[n]._node)),delete i[n]._node,e._clearTimer(i[n]._id);var o=t._howls.indexOf(e);o>=0&&t._howls.splice(o,1);var u=!0;for(n=0;n<t._howls.length;n++)if(t._howls[n]._src===e._src||e._src.indexOf(t._howls[n]._src)>=0){u=!1;break}return f&&u&&delete f[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,i,n,o){var u=this,h=u["_on"+e];return typeof i=="function"&&h.push(o?{id:n,fn:i,once:o}:{id:n,fn:i}),u},off:function(e,i,n){var o=this,u=o["_on"+e],h=0;if(typeof i=="number"&&(n=i,i=null),i||n)for(h=0;h<u.length;h++){var l=n===u[h].id;if(i===u[h].fn&&l||!i&&l){u.splice(h,1);break}}else if(e)o["_on"+e]=[];else{var m=Object.keys(o);for(h=0;h<m.length;h++)m[h].indexOf("_on")===0&&Array.isArray(o[m[h]])&&(o[m[h]]=[])}return o},once:function(e,i,n){var o=this;return o.on(e,i,n,1),o},_emit:function(e,i,n){for(var o=this,u=o["_on"+e],h=u.length-1;h>=0;h--)(!u[h].id||u[h].id===i||e==="load")&&(setTimeout(function(l){l.call(this,i,n)}.bind(o,u[h].fn),0),u[h].once&&o.off(e,u[h].fn,u[h].id));return o._loadQueue(e),o},_loadQueue:function(e){var i=this;if(i._queue.length>0){var n=i._queue[0];n.event===e&&(i._queue.shift(),i._loadQueue()),e||n.action()}return i},_ended:function(e){var i=this,n=e._sprite;if(!i._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(i._ended.bind(i,e),100),i;var o=!!(e._loop||i._sprite[n][2]);if(i._emit("end",e._id),!i._webAudio&&o&&i.stop(e._id,!0).play(e._id),i._webAudio&&o){i._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var u=(e._stop-e._start)*1e3/Math.abs(e._rate);i._endTimers[e._id]=setTimeout(i._ended.bind(i,e),u)}return i._webAudio&&!o&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,i._clearTimer(e._id),i._cleanBuffer(e._node),t._autoSuspend()),!i._webAudio&&!o&&i.stop(e._id,!0),i},_clearTimer:function(e){var i=this;if(i._endTimers[e]){if(typeof i._endTimers[e]!="function")clearTimeout(i._endTimers[e]);else{var n=i._soundById(e);n&&n._node&&n._node.removeEventListener("ended",i._endTimers[e],!1)}delete i._endTimers[e]}return i},_soundById:function(e){for(var i=this,n=0;n<i._sounds.length;n++)if(e===i._sounds[n]._id)return i._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var i=0;i<e._sounds.length;i++)if(e._sounds[i]._ended)return e._sounds[i].reset();return new a(e)},_drain:function(){var e=this,i=e._pool,n=0,o=0;if(!(e._sounds.length<i)){for(o=0;o<e._sounds.length;o++)e._sounds[o]._ended&&n++;for(o=e._sounds.length-1;o>=0;o--){if(n<=i)return;e._sounds[o]._ended&&(e._webAudio&&e._sounds[o]._node&&e._sounds[o]._node.disconnect(0),e._sounds.splice(o,1),n--)}}},_getSoundIds:function(e){var i=this;if(typeof e=="undefined"){for(var n=[],o=0;o<i._sounds.length;o++)n.push(i._sounds[o]._id);return n}else return[e]},_refreshBuffer:function(e){var i=this;return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=f[i._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),i},_cleanBuffer:function(e){var i=this,n=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),n))try{e.bufferSource.buffer=t._scratchBuffer}catch{}return e.bufferSource=null,i},_clearSound:function(e){var i=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);i||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,i._sounds.push(e),e.create(),e},create:function(){var e=this,i=e._parent,n=t._muted||e._muted||e._parent._muted?0:e._volume;return i._webAudio?(e._node=typeof t.ctx.createGain=="undefined"?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(n,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=i._src,e._node.preload=i._preload===!0?"auto":i._preload,e._node.volume=n*t.volume(),e._node.load()),e},reset:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,i=e._parent;i._duration=Math.ceil(e._node.duration*10)/10,Object.keys(i._sprite).length===0&&(i._sprite={__default:[0,i._duration*1e3]}),i._state!=="loaded"&&(i._state="loaded",i._emit("load"),i._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,i=e._parent;i._duration===1/0&&(i._duration=Math.ceil(e._node.duration*10)/10,i._sprite.__default[1]===1/0&&(i._sprite.__default[1]=i._duration*1e3),i._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var f={},d=function(e){var i=e._src;if(f[i]){e._duration=f[i].duration,p(e);return}if(/^data:[^;]+;base64,/.test(i)){for(var n=atob(i.split(",")[1]),o=new Uint8Array(n.length),u=0;u<n.length;++u)o[u]=n.charCodeAt(u);_(o.buffer,e)}else{var h=new XMLHttpRequest;h.open(e._xhr.method,i,!0),h.withCredentials=e._xhr.withCredentials,h.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(l){h.setRequestHeader(l,e._xhr.headers[l])}),h.onload=function(){var l=(h.status+"")[0];if(l!=="0"&&l!=="2"&&l!=="3"){e._emit("loaderror",null,"Failed loading audio file with status: "+h.status+".");return}_(h.response,e)},h.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete f[i],e.load())},c(h)}},c=function(e){try{e.send()}catch{e.onerror()}},_=function(e,i){var n=function(){i._emit("loaderror",null,"Decoding audio data failed.")},o=function(u){u&&i._sounds.length>0?(f[i._src]=u,p(i,u)):n()};typeof Promise!="undefined"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(e).then(o).catch(n):t.ctx.decodeAudioData(e,o,n)},p=function(e,i){i&&!e._duration&&(e._duration=i.duration),Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue())},x=function(){if(!!t.usingWebAudio){try{typeof AudioContext!="undefined"?t.ctx=new AudioContext:typeof webkitAudioContext!="undefined"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),i=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=i?parseInt(i[1],10):null;if(e&&n&&n<9){var o=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!o&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain=="undefined"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};v.Howler=t,v.Howl=s,typeof F!="undefined"?(F.HowlerGlobal=r,F.Howler=t,F.Howl=s,F.Sound=a):typeof window!="undefined"&&(window.HowlerGlobal=r,window.Howler=t,window.Howl=s,window.Sound=a)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var s=this;if(!s.ctx||!s.ctx.listener)return s;for(var a=s._howls.length-1;a>=0;a--)s._howls[a].stereo(t);return s},HowlerGlobal.prototype.pos=function(t,s,a){var f=this;if(!f.ctx||!f.ctx.listener)return f;if(s=typeof s!="number"?f._pos[1]:s,a=typeof a!="number"?f._pos[2]:a,typeof t=="number")f._pos=[t,s,a],typeof f.ctx.listener.positionX!="undefined"?(f.ctx.listener.positionX.setTargetAtTime(f._pos[0],Howler.ctx.currentTime,.1),f.ctx.listener.positionY.setTargetAtTime(f._pos[1],Howler.ctx.currentTime,.1),f.ctx.listener.positionZ.setTargetAtTime(f._pos[2],Howler.ctx.currentTime,.1)):f.ctx.listener.setPosition(f._pos[0],f._pos[1],f._pos[2]);else return f._pos;return f},HowlerGlobal.prototype.orientation=function(t,s,a,f,d,c){var _=this;if(!_.ctx||!_.ctx.listener)return _;var p=_._orientation;if(s=typeof s!="number"?p[1]:s,a=typeof a!="number"?p[2]:a,f=typeof f!="number"?p[3]:f,d=typeof d!="number"?p[4]:d,c=typeof c!="number"?p[5]:c,typeof t=="number")_._orientation=[t,s,a,f,d,c],typeof _.ctx.listener.forwardX!="undefined"?(_.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),_.ctx.listener.forwardY.setTargetAtTime(s,Howler.ctx.currentTime,.1),_.ctx.listener.forwardZ.setTargetAtTime(a,Howler.ctx.currentTime,.1),_.ctx.listener.upX.setTargetAtTime(f,Howler.ctx.currentTime,.1),_.ctx.listener.upY.setTargetAtTime(d,Howler.ctx.currentTime,.1),_.ctx.listener.upZ.setTargetAtTime(c,Howler.ctx.currentTime,.1)):_.ctx.listener.setOrientation(t,s,a,f,d,c);else return p;return _},Howl.prototype.init=function(t){return function(s){var a=this;return a._orientation=s.orientation||[1,0,0],a._stereo=s.stereo||null,a._pos=s.pos||null,a._pannerAttr={coneInnerAngle:typeof s.coneInnerAngle!="undefined"?s.coneInnerAngle:360,coneOuterAngle:typeof s.coneOuterAngle!="undefined"?s.coneOuterAngle:360,coneOuterGain:typeof s.coneOuterGain!="undefined"?s.coneOuterGain:0,distanceModel:typeof s.distanceModel!="undefined"?s.distanceModel:"inverse",maxDistance:typeof s.maxDistance!="undefined"?s.maxDistance:1e4,panningModel:typeof s.panningModel!="undefined"?s.panningModel:"HRTF",refDistance:typeof s.refDistance!="undefined"?s.refDistance:1,rolloffFactor:typeof s.rolloffFactor!="undefined"?s.rolloffFactor:1},a._onstereo=s.onstereo?[{fn:s.onstereo}]:[],a._onpos=s.onpos?[{fn:s.onpos}]:[],a._onorientation=s.onorientation?[{fn:s.onorientation}]:[],t.call(this,s)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,s){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"stereo",action:function(){a.stereo(t,s)}}),a;var f=typeof Howler.ctx.createStereoPanner=="undefined"?"spatial":"stereo";if(typeof s=="undefined")if(typeof t=="number")a._stereo=t,a._pos=[t,0,0];else return a._stereo;for(var d=a._getSoundIds(s),c=0;c<d.length;c++){var _=a._soundById(d[c]);if(_)if(typeof t=="number")_._stereo=t,_._pos=[t,0,0],_._node&&(_._pannerAttr.panningModel="equalpower",(!_._panner||!_._panner.pan)&&r(_,f),f==="spatial"?typeof _._panner.positionX!="undefined"?(_._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),_._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),_._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):_._panner.setPosition(t,0,0):_._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),a._emit("stereo",_._id);else return _._stereo}return a},Howl.prototype.pos=function(t,s,a,f){var d=this;if(!d._webAudio)return d;if(d._state!=="loaded")return d._queue.push({event:"pos",action:function(){d.pos(t,s,a,f)}}),d;if(s=typeof s!="number"?0:s,a=typeof a!="number"?-.5:a,typeof f=="undefined")if(typeof t=="number")d._pos=[t,s,a];else return d._pos;for(var c=d._getSoundIds(f),_=0;_<c.length;_++){var p=d._soundById(c[_]);if(p)if(typeof t=="number")p._pos=[t,s,a],p._node&&((!p._panner||p._panner.pan)&&r(p,"spatial"),typeof p._panner.positionX!="undefined"?(p._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),p._panner.positionY.setValueAtTime(s,Howler.ctx.currentTime),p._panner.positionZ.setValueAtTime(a,Howler.ctx.currentTime)):p._panner.setPosition(t,s,a)),d._emit("pos",p._id);else return p._pos}return d},Howl.prototype.orientation=function(t,s,a,f){var d=this;if(!d._webAudio)return d;if(d._state!=="loaded")return d._queue.push({event:"orientation",action:function(){d.orientation(t,s,a,f)}}),d;if(s=typeof s!="number"?d._orientation[1]:s,a=typeof a!="number"?d._orientation[2]:a,typeof f=="undefined")if(typeof t=="number")d._orientation=[t,s,a];else return d._orientation;for(var c=d._getSoundIds(f),_=0;_<c.length;_++){var p=d._soundById(c[_]);if(p)if(typeof t=="number")p._orientation=[t,s,a],p._node&&(p._panner||(p._pos||(p._pos=d._pos||[0,0,-.5]),r(p,"spatial")),typeof p._panner.orientationX!="undefined"?(p._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),p._panner.orientationY.setValueAtTime(s,Howler.ctx.currentTime),p._panner.orientationZ.setValueAtTime(a,Howler.ctx.currentTime)):p._panner.setOrientation(t,s,a)),d._emit("orientation",p._id);else return p._orientation}return d},Howl.prototype.pannerAttr=function(){var t=this,s=arguments,a,f,d;if(!t._webAudio)return t;if(s.length===0)return t._pannerAttr;if(s.length===1)if(typeof s[0]=="object")a=s[0],typeof f=="undefined"&&(a.pannerAttr||(a.pannerAttr={coneInnerAngle:a.coneInnerAngle,coneOuterAngle:a.coneOuterAngle,coneOuterGain:a.coneOuterGain,distanceModel:a.distanceModel,maxDistance:a.maxDistance,refDistance:a.refDistance,rolloffFactor:a.rolloffFactor,panningModel:a.panningModel}),t._pannerAttr={coneInnerAngle:typeof a.pannerAttr.coneInnerAngle!="undefined"?a.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof a.pannerAttr.coneOuterAngle!="undefined"?a.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof a.pannerAttr.coneOuterGain!="undefined"?a.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof a.pannerAttr.distanceModel!="undefined"?a.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof a.pannerAttr.maxDistance!="undefined"?a.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof a.pannerAttr.refDistance!="undefined"?a.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof a.pannerAttr.rolloffFactor!="undefined"?a.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof a.pannerAttr.panningModel!="undefined"?a.pannerAttr.panningModel:t._panningModel});else return d=t._soundById(parseInt(s[0],10)),d?d._pannerAttr:t._pannerAttr;else s.length===2&&(a=s[0],f=parseInt(s[1],10));for(var c=t._getSoundIds(f),_=0;_<c.length;_++)if(d=t._soundById(c[_]),d){var p=d._pannerAttr;p={coneInnerAngle:typeof a.coneInnerAngle!="undefined"?a.coneInnerAngle:p.coneInnerAngle,coneOuterAngle:typeof a.coneOuterAngle!="undefined"?a.coneOuterAngle:p.coneOuterAngle,coneOuterGain:typeof a.coneOuterGain!="undefined"?a.coneOuterGain:p.coneOuterGain,distanceModel:typeof a.distanceModel!="undefined"?a.distanceModel:p.distanceModel,maxDistance:typeof a.maxDistance!="undefined"?a.maxDistance:p.maxDistance,refDistance:typeof a.refDistance!="undefined"?a.refDistance:p.refDistance,rolloffFactor:typeof a.rolloffFactor!="undefined"?a.rolloffFactor:p.rolloffFactor,panningModel:typeof a.panningModel!="undefined"?a.panningModel:p.panningModel};var x=d._panner;x?(x.coneInnerAngle=p.coneInnerAngle,x.coneOuterAngle=p.coneOuterAngle,x.coneOuterGain=p.coneOuterGain,x.distanceModel=p.distanceModel,x.maxDistance=p.maxDistance,x.refDistance=p.refDistance,x.rolloffFactor=p.rolloffFactor,x.panningModel=p.panningModel):(d._pos||(d._pos=t._pos||[0,0,-.5]),r(d,"spatial"))}return t},Sound.prototype.init=function(t){return function(){var s=this,a=s._parent;s._orientation=a._orientation,s._stereo=a._stereo,s._pos=a._pos,s._pannerAttr=a._pannerAttr,t.call(this),s._stereo?a.stereo(s._stereo):s._pos&&a.pos(s._pos[0],s._pos[1],s._pos[2],s._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var s=this,a=s._parent;return s._orientation=a._orientation,s._stereo=a._stereo,s._pos=a._pos,s._pannerAttr=a._pannerAttr,s._stereo?a.stereo(s._stereo):s._pos?a.pos(s._pos[0],s._pos[1],s._pos[2],s._id):s._panner&&(s._panner.disconnect(0),s._panner=void 0,a._refreshBuffer(s)),t.call(this)}}(Sound.prototype.reset);var r=function(t,s){s=s||"spatial",s==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX!="undefined"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX!="undefined"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()})(H);const X=Object.freeze({TakeDamage:"take-damage",OnDead:"on-dead"});class Te extends U{constructor(r){let t=[];for(let s=1;s<=16;s++)t.push(b.get(`/assets/images/animation/ship/${s}.png`));super(r,t,{duration:.5,loop:!0,autoPlay:!0}),this.gl=r,this.listEnemy=[],this.listHealth=[],this.transform.position.x=this.gl.canvas.width/2,this.transform.position.y=800,this.transform.rotation=-Math.PI/2,this.health=3,this.setupGlow(),this.initExplosion(),this.setupHealth()}initExplosion(){let r=[];for(let t=1;t<=16;t++)r.push(b.get(`/assets/images/animation/explosion/${t}.png`));this.explosion=new U(this.gl,r,{duration:.5,loop:!1,autoPlay:!1,onComplete:()=>{this.emit(X.OnDead,this)}}),this.addChild(this.explosion)}setupGlow(){let r=b.get("/assets/images/glow.png");this.particle=new Ae(r,{x:this.globalPosition.x,y:this.globalPosition.y+25,numParticles:100,birthRate:1,minLifeRange:.05,maxLifeRange:.12,minTheta:-Math.PI/2,maxTheta:-Math.PI/2,minSpeed:.5,maxSpeed:1,startScale:.1,endScale:.07,gravity:[0,-.8]}),this.addChild(this.particle),this.particle.play()}updatePosition(r,t){this._destroyed||(this.transform.position.x=r,this.transform.position.y=t)}updateTransform(){super.updateTransform(),this.particle.x=this.globalPosition.x,this.particle.y=this.globalPosition.y+25}setupHealth(){let r=b.get("/assets/images/heart.png");for(let t=0;t<this.health;t++){let s=new S(this.gl,r);s.transform.scale.set(.5,.5),s.transform.position.x=-70,s.transform.position.y=(t-1)*40,this.listHealth.push(s),this.addChild(s)}}takeDamage(){this.health-=1;let r=this.listHealth.pop();r&&r.destroy(),this.health===0&&this.onDead()}onDead(){this.explosion.play();var r=new H.Howl({src:["/assets/audio/sfx_explosion.mp3"],volume:.5});r.play()}}class be extends S{constructor(r,t){super(r,t),this.gl=r,this.textureEnemy=t,this.health=1,this.initExplosion()}initExplosion(){let r=[];for(let t=1;t<=16;t++)r.push(b.get(`/assets/images/animation/explosion/${t}.png`));this.explosion=new U(this.gl,r,{duration:.5,loop:!1,autoPlay:!1,onComplete:()=>{this.destroy()}}),this.addChild(this.explosion)}setPosition(r,t){this.destroyed||(this.transform.position.x=r,this.transform.position.y=t)}updatePosition(r){this.destroyed||(this.transform.position.y+=r)}takeDamage(){return this.health-=1,this.health}getHealth(){return this.health}onEnemyDead(){this.explosion.play()}}class ne{static rectIntersect(r,t,s,a,f,d,c,_){return!(f>s+r||r>c+f||d>a+t||t>_+d)}static isCollision(r,t){return r.transform===null||t.transform===null?!1:!!this.rectIntersect(r.transform.position.x,r.transform.position.y,r.transform.width,r.transform.height,t.transform.position.x,t.transform.position.y,t.transform.width,t.transform.height)}}class xe extends U{constructor(r){let t=[];for(let s=1;s<=48;s++)t.push(b.get(`/assets/images/animation/boss/${s}.png`));super(r,t,{duration:2,loop:!0,autoPlay:!0}),this.transform.rotation=-Math.PI/2,this.transform.scale.set(1.5,1.5),this.gl=r,this.health=200}setPosition(r,t){this.destroyed||(this.transform.position.x=r,this.transform.position.y=t)}updatePosition(r){this.destroyed||(this.transform.position.y+=r)}takeDamage(){return this.health-=1,this.health}getHealth(){return this.health}onEnemyDead(){console.log("EnemyDead")}}class Y extends S{constructor(r,t){super(r,t),this.gl=r,this.textureBullet=t,this.transform.rotation=-Math.PI/2,this.initExplosion()}setPosition(r,t){this.transform.position.x=r,this.transform.position.y=t}initExplosion(){let r=[];for(let t=1;t<=16;t++)r.push(b.get(`/assets/images/animation/explosion/${t}.png`));this.explosion=new U(this.gl,r,{duration:.5,loop:!1,autoPlay:!1,onComplete:()=>{this.destroy()}}),this.addChild(this.explosion)}updatePosition(){w.SharedTicker.add((r,t)=>{this._destroyed||(this.transform.position.y<0?this.destroy():this.transform.position.y-=r*1e3)})}updatePositionBoss(){w.SharedTicker.add((r,t)=>{this._destroyed||(this.transform.position.y>900?this.destroy():this.transform.position.y+=r*500)})}onEnemyDead(){this.explosion.play()}}const L=Object.freeze({OnClearEnemy:"clear-enemy",RunTweenDone:"run-tween-done"});class ee extends B{constructor(r,t,s,a){super(),this.gl=r,this.numEnemy=t,this.listEnemy=[],this.listBullet=[],this.player=a,this.delaySpawn=!0,this.attackSkill=!0,this.isRunTween=!0,s!==null?(this.textureEnemy=s,this.initEnemy()):this.initBoss(),this.update()}initEnemy(){for(let r=0;r<this.numEnemy;r++){let t=this.textureEnemy,s=new be(this.gl,t);s.type="ship";let a=this.gl.canvas.width/(this.numEnemy+1);s.setPosition(a*r+a/2,0);let f=0;r%2!==0&&(s.setPosition(a*r+a/2,100),f=100),this.listEnemy.push(s),this.addChild(s),R.createTween(s,{y:f+100},{duration:1,onComplete:()=>{this.isRunTween=!1,this.emit(L.RunTweenDone,this)}}).start()}for(let r=0;r<this.listEnemy.length;r++){let t=this.listEnemy[r].transform.position.x+50;r%2!==0&&(t=this.listEnemy[r].transform.position.x-50);let s=this.listEnemy[r],a=R.createTween({x:s.position.x},{x:t},{onUpdate:f=>{var d;s&&!((d=this.enemy)!=null&&d._destroyed)&&s.transform?s.position.x=f.x:a.stop()},duration:1,loop:!0,yoyo:!0});a.start()}w.SharedTicker.add(r=>{this.delaySpawn&&(this.delaySpawn=!1,setTimeout(()=>{this.spawnBulletEnemy()},1e3))})}initBoss(){this.boss=new xe(this.gl),this.boss.type="ship",this.boss.setPosition(this.gl.canvas.width/2,0);let r=0;this.listEnemy.push(this.boss),this.addChild(this.boss),w.SharedTicker.add(s=>{this.delaySpawn&&(this.delaySpawn=!1,setTimeout(()=>{this.spawnBulletBoss()},500))}),R.createTween(this.boss,{y:r+200},{duration:1,onComplete:()=>{this.isRunTween=!1,this.emit(L.RunTweenDone,this)}}).start();for(let s=0;s<this.listEnemy.length;s++){let a=this.listEnemy[s].transform.position.x+700,f=this.listEnemy[s],d=R.createTween({x:f.position.x-700},{x:a},{onUpdate:c=>{var _;f&&!((_=this.enemy)!=null&&_._destroyed)&&f.transform?f.position.x=c.x:d.stop()},duration:4,loop:!0,yoyo:!0});d.start()}let t=R.createTween({y:this.boss.position.y-100},{y:300},{onUpdate:s=>{var a;this.boss&&!((a=this.boss)!=null&&a._destroyed)&&this.boss.transform?this.boss.position.y=s.y:t.stop()},duration:9,loop:!0,yoyo:!0,onComplete:()=>{this.attackSkill=!0}});t.start()}updatePosition(r,t){this.transform.position.x=r,this.transform.position.y=t}spawnBulletEnemy(){this.delaySpawn=!0;let r=b.get("/assets/images/enemy/bulletEnemy.png"),t=new Y(this.gl,r);t.type="bullet",t.transform.scale.set(.5,.5),this.listEnemy.push(t),this.addChild(t);let s=this.listEnemy[Math.floor(Math.random()*(this.listEnemy.length-1))];t.transform.position.x=s.transform.position.x,t.transform.position.y=s.transform.position.y,w.SharedTicker.add(a=>{t._destroyed||(t.transform.position.y>1e3?this.removeEnemy(t,!1):t.transform.position.y+=a*100)})}spawnBulletBoss(){this.delaySpawn=!0;let r=b.get("/assets/images/bullet_enemy.png");for(let t=0;t<3;t++){let s;s=new Y(this.gl,r),s.transform.width=25,s.transform.height=50,s.type="bullet",this.addChild(s),s.setPosition(this.boss.transform.position.x-200+200*t,this.boss.transform.position.y-.1*t),this.listBullet.push(s),this.listEnemy.push(s)}this.listBullet.forEach(t=>{t.updatePositionBoss()}),this.listBullet=[]}removeEnemy(r,t=!0){if(!this.isRunTween){let a=this.listEnemy.indexOf(r);a>=0&&(this.listEnemy.splice(a,1),r.type==="ship"&&t?this.playSoundExplode():(r.onEnemyDead(),t&&this.playSoundExplode()))}this.getEnemyShip().length===0&&this.emit(L.OnClearEnemy,this)}playSoundExplode(){var r=new H.Howl({src:["/assets/audio/sfx_enemy_explode.mp3"],volume:.5});r.play()}getEnemyShip(){let r=[];for(let s=0;s<this.listEnemy.length;s++){var t=this.listEnemy[s];t.type==="ship"&&r.push(t)}return r}update(){w.SharedTicker.add(()=>{for(let r=0;r<this.listEnemy.length;r++){let t=this.listEnemy[r];ne.isCollision(this.player,t)&&(this.player.emit(X.TakeDamage),t.type==="bullet"&&this.removeEnemy(t))}})}}const se=Object.freeze({RemoveEnemy:"remove-enemy"});class we extends B{constructor(r,t,s,a){super(),this.gl=r,this.enemy=a,this.textureBullet=s,this.checkLevel=t,this.listBullet=[],this.bulletChecker=[],this.update()}updatePosition(r,t){this.posX=r,this.posY=t}removeGo(r,t=!0){if(t){let s=this.bulletChecker.indexOf(r);s>=0&&this.bulletChecker.splice(s,1)}else{let s=this.enemy.indexOf(r);s>=0&&(this.enemy.splice(s,1),r.onEnemyDead())}}spawnBullet(){for(let r=0;r<this.checkLevel;r++){let t;this.checkLevel===1?(t=new Y(this.gl,this.textureBullet),this.addChild(t),t.setPosition(this.posX,this.posY),this.listBullet.push(t)):(this.checkLevel===2||this.checkLevel===3)&&(t=new Y(this.gl,this.textureBullet),this.addChild(t),t.setPosition(this.posX-10+20*r,this.posY-.1*r),this.listBullet.push(t)),t.transform.width=25,t.transform.height=60,this.bulletChecker.push(t)}this.listBullet.forEach(r=>{r.updatePosition()}),this.listBullet=[]}update(){w.SharedTicker.add(()=>{for(let r=0;r<this.enemy.length;r++){let t=this.enemy[r];for(let s=0;s<this.bulletChecker.length;s++){let a=this.bulletChecker[s];ne.isCollision(t,a)&&(this.removeGo(a),a.destroy(),t.takeDamage(),t.getHealth()===0&&(this.removeGo(t,!1),this.emit(se.RemoveEnemy,t)))}}})}}class Se extends B{constructor(r){super(r),this.gl=r}initStartUI(){let r=b.get("/assets/images/UI/logo.png"),t=new S(this.gl,r);t.transform.position.x=this.gl.canvas.width/2,t.transform.position.y=this.gl.canvas.height/2-200,t.transform.scale.set(1,1),this.addChild(t);let s=b.get("/assets/images/UI/buttonStart.png"),a=new S(this.gl,s);a.transform.position.x=this.gl.canvas.width/2,a.transform.position.y=this.gl.canvas.height/2+50,a.transform.scale.set(1.5,1.5),this.addChild(a),window.addEventListener("mousedown",f=>{a._destroyed||f.pageX>=a.transform.position.x-a.transform.width/2&&f.pageX<a.transform.position.x+a.transform.width/2&&f.pageY>=a.transform.position.y-a.transform.height/2&&f.pageY<a.transform.position.y+a.transform.height/2&&R.createTween({x:1.5},{x:1},{duration:.2,yoyo:!0,repeat:1,onUpdate:d=>{a.transform.scale.set(d.x,d.x)},onComplete:()=>{this.emit("loadGame"),t.destroy(),a.destroy()}}).start()})}initGameOverUI(){let r=b.get("/assets/images/UI/gameOverLogo.png"),t=new S(this.gl,r);t.transform.position.x=this.gl.canvas.width/2,t.transform.position.y=this.gl.canvas.height/2,t.transform.scale.set(1,1),this.addChild(t)}initWinUI(){let r=b.get("/assets/images/UI/bgWinner.png"),t=new S(this.gl,r);t.transform.position.x=this.gl.canvas.width/2,t.transform.position.y=this.gl.canvas.height/2-100,t.blendType=k.BLEND_TYPE.ADDITIVE,t.transform.scale.set(3,3),this.addChild(t),w.SharedTicker.add(c=>{t._destroyed||(t.transform.rotation+=.01)});let s=b.get("/assets/images/UI/levelComplete.png"),a=new S(this.gl,s);a.transform.position.x=this.gl.canvas.width/2,a.transform.position.y=this.gl.canvas.height/2-100,a.transform.scale.set(.1,.1),this.addChild(a);let f=b.get("/assets/images/UI/buttonNext.png"),d=new S(this.gl,f);d.transform.position.x=this.gl.canvas.width/2,d.transform.position.y=this.gl.canvas.height/2+80,d.transform.scale.set(1.5,1.5),this.addChild(d),window.addEventListener("mousedown",c=>{d._destroyed||c.pageX>=d.transform.position.x-d.transform.width/2&&c.pageX<d.transform.position.x+d.transform.width/2&&c.pageY>=d.transform.position.y-d.transform.height/2&&c.pageY<d.transform.position.y+d.transform.height/2&&R.createTween({x:1.5},{x:1},{duration:.2,yoyo:!0,repeat:1,onUpdate:_=>{d.transform.scale.set(_.x,_.x)},onComplete:()=>{this.emit("loadGame"),a.destroy(),t.destroy(),d.destroy()}}).start()})}}class Ee extends B{constructor(r=100){super(),this.speed=r,this._init(),this.position.x=this.gl.canvas.width/2,this.position.y=this.gl.canvas.height/2,w.SharedTicker.add(this._update,this)}_init(){this.bgTop=this._createBackground("/assets/images/bg_top.png"),this.bgTop.pivot.y=1,this.bgBottom=this._createBackground("/assets/images/bg_bottom.png"),this.bgBottom.pivot.y=1,this.bgBottom.position.y=this.bgTop.position.y+this.bgTop.texture.height*this.bgTop.scale.y-1,this.addChild(this.bgTop),this.addChild(this.bgBottom)}_update(r){this.bgTop.position.y+=this.speed*r,this.bgBottom.position.y+=this.speed*r,this.bgTop.position.y>=this.bgTop.texture.height*this.bgTop.scale.y+this.gl.canvas.height/2&&(this.bgTop.position.y=this.bgBottom.position.y-this.bgBottom.texture.height*this.bgBottom.scale.y),this.bgBottom.position.y>=this.bgBottom.texture.height*this.bgBottom.scale.y+this.gl.canvas.height/2&&(this.bgBottom.position.y=this.bgTop.position.y-this.bgTop.texture.height*this.bgTop.scale.y)}_createBackground(r){const t=b.get(r),s=new S(this.gl,t);let a=this.gl.canvas.width/t.width;return s.scale.set(a,a),s.height=t.height*a,s}}class Pe extends O{constructor(r){super(r)}init(r){this.font=r,this._initShaderProgram(ie,re),this._initShaderAttributes(),this.makeVerticesForString(this.font.info,"a")}makeVerticesForString(r,t){for(var s=t.length,a=s*6,f=new Float32Array(a*2),d=new Float32Array(a*2),c=0,_=0,p=r.textureWidth,x=r.textureHeight,e=0;e<s;++e){var i=t[e],n=r.glyphInfos[i];if(n){var o=_+n.width,u=n.x/p,h=(n.y+r.letterHeight-1)/x,l=(n.x+n.width-1)/p,m=n.y/x;f[c+0]=_,f[c+1]=0,d[c+0]=u,d[c+1]=h,f[c+2]=o,f[c+3]=0,d[c+2]=l,d[c+3]=h,f[c+4]=_,f[c+5]=r.letterHeight,d[c+4]=u,d[c+5]=m,f[c+6]=_,f[c+7]=r.letterHeight,d[c+6]=u,d[c+7]=m,f[c+8]=o,f[c+9]=0,d[c+8]=l,d[c+9]=h,f[c+10]=o,f[c+11]=r.letterHeight,d[c+10]=l,d[c+11]=m,_+=n.width+r.spacing,c+=12}else _+=r.spaceWidth}return{arrays:{position:new Float32Array(f.buffer,0,c),texcoord:new Float32Array(d.buffer,0,c)},numVertices:c/2}}activateShader(r){this.gl.useProgram(this.program),this.gl.bindVertexArray(this.vao);var t=this.makeVerticesForString(this.font.info,r);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.arrays.position,this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,t.arrays.texcoord,this.gl.DYNAMIC_DRAW),this.gl.uniform1i(this.textureLocation,0),this.gl.activeTexture(this.gl.TEXTURE0+0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.font.texture),this.gl.drawArrays(this.gl.TRIANGLES,0,t.numVertices)}}class Re extends B{constructor(r,t="",s=te.WHITE){super(),this.text=t,this.color=s,this.font=r}_initBeforeFirstRender(){this.transform.isText=!0,this.shader=new Pe(this.gl),this.shader.init(this.font)}_render(){this.shader.activateShader(this.text,this.size,this.color)}updateTransform(){super.updateTransform(),this.shader.updateTransform(this.transform.worldTransform.array)}}class Le{constructor(){this.core=new he,this.core.init("canvas"),this.core.resizeCanvasToDisplaySize(),this.numEnemy=15,this.delaySpawn=!0,this.speed=100,this.delayAttack=!0,this.checkLevel=2,this.canShoot=!1,this.level=1,this.load(),w.SharedTicker.add(()=>{this.core.update()})}load(){z.defaultFont(this.core.gl),A.addAnimationSprite("/assets/images/animation/ship/",16),A.addAnimationSprite("/assets/images/animation/boss/",48),A.addAnimationSprite("/assets/images/animation/explosion/",20),A.addSrc("/assets/images/sad.png"),A.addSrc("/assets/images/glow.png"),A.addSrc("/assets/images/bg_top.png"),A.addSrc("/assets/images/bg_bottom.png"),A.addSrc("/assets/images/redBullet.png"),A.addSrc("/assets/images/heart.png"),A.addSrc("/assets/images/bullet_enemy.png"),A.addSrc("/assets/images/bullet_purple.png"),A.addSrc("/assets/images/enemy/enemy_1.png"),A.addSrc("/assets/images/enemy/bulletEnemy.png"),A.addSrc("/assets/images/UI/gameOverLogo.png"),A.addSrc("/assets/images/UI/buttonStart.png"),A.addSrc("/assets/images/UI/buttonNext.png"),A.addSrc("/assets/images/UI/levelComplete.png"),A.addSrc("/assets/images/UI/logo.png"),A.addSrc("/assets/images/UI/bgWinner.png"),A.load(this.core.gl,this.init,this)}init(){this.initBackground(),this.initUI(),this.initFPSWatcher()}initBackground(){this.bg=new Ee,this.core.stage.addChild(this.bg)}initUI(){this.gameUI=new Se(this.core.gl),this.core.stage.addChild(this.gameUI),this.gameUI.on("loadGame",this.playGame,this),this.gameUI.initStartUI()}initFPSWatcher(){this.fpsWatcher=new Re(z._defaultFont,"fps 0"),this.fpsWatcher.transform.position.set(40,70),this.fpsWatcher.transform.scale.set(-4,-4),this.core.stage.addChild(this.fpsWatcher);let r=0,t=0;this.core.on("update",()=>{t++;let s=performance.now();s-r>1e3&&(this.fpsWatcher.text=`fps ${t}`,r=s,t=0)})}playGame(){this.spawnShip(),this.level===1?this.spawnEnemy():this.spawnBoss(),this.initBulletManager(),this.initController(),this.playBackgroundMusic()}playBackgroundMusic(){this.music=new H.Howl({src:["/assets/audio/music_bg.mp3"],loop:!0,volume:1,autoplay:!0})}initController(){window.addEventListener("mousemove",r=>{this.ship.updatePosition(r.pageX,r.pageY)}),w.SharedTicker.add(r=>{this.delayAttack&&(setTimeout(()=>{this.canShoot&&(this.spawnBullet(this.ship.transform.position.x,this.ship.transform.position.y),this.sound=new H.Howl({src:["/assets/audio/sfx_shoot.wav"],volume:.5}),this.sound.play()),this.delayAttack=!0},this.speed),this.delayAttack=!1)})}spawnShip(){this.ship=new Te(this.core.gl),this.ship.on(X.TakeDamage,this.ship.takeDamage,this.ship),this.core.stage.addChild(this.ship),this.ship.on(X.OnDead,this.defeat,this)}spawnEnemy(){let r=b.get("/assets/images/enemy/enemy_1.png");this.enemyManager=new ee(this.core.gl,this.numEnemy,r,this.ship),this.core.stage.addChild(this.enemyManager),this.enemyManager.on(L.OnClearEnemy,this.win,this),this.enemyManager.on(L.RunTweenDone,()=>{this.canShoot=!0},this)}spawnBoss(){this.enemyManager=new ee(this.core.gl,this.numEnemy,null,this.ship),this.core.stage.addChild(this.enemyManager),this.enemyManager.on(L.OnClearEnemy,this.win,this),this.enemyManager.on(L.RunTweenDone,()=>{this.canShoot=!0},this)}spawnBullet(r,t){this.bulletManager.updatePosition(r,t),this.bulletManager.spawnBullet()}initBulletManager(){let r=this.enemyManager.getEnemyShip(),t=b.get("/assets/images/bullet_purple.png");this.bulletManager=new we(this.core.gl,this.checkLevel,t,r),this.core.stage.addChild(this.bulletManager),this.bulletManager.on(se.RemoveEnemy,this.enemyManager.removeEnemy,this.enemyManager)}defeat(){this.music.stop(),this.ship.destroy(),this.enemyManager.destroy(),this.canShoot=!1,this.gameUI.initGameOverUI(),console.log("on lose")}win(){this.music.stop(),this.ship.destroy(),this.enemyManager.destroy(),this.canShoot=!1,this.level=2,this.checkLevel=3,this.gameUI.initWinUI(),console.log("win")}}document.addEventListener("DOMContentLoaded",()=>{new Le});
